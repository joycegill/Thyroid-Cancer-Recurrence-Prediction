---
title: 'Predicting Thyroid Cancer Recurrence'
author: "Joyce Gill, Matthew Billings-Chiu"
date: "2025-05-02"
output:
  pdf_document:
    toc: true
    toc_dept: 2
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo = F, include = F}
library(dplyr)
library(ggplot2)
library(tidyr)
library(forcats)
library(kableExtra)
library(gridExtra)
```

```{r echo = F, include = F}
## Open Data
data <- read.csv("https://raw.githubusercontent.com/joycegill/Thyroid-Cancer-Recurrence-Prediction/main/filtered_thyroid_data.csv")
```

\newpage
## **Introduction**
  Cancer is the unregulated proliferation of cells which consume dangerous and disproportionately high amounts of energy from the body. These cells can shunt blood flow to maintain their high metabolic cost and increasing size (potentially blocking organ function), which becomes deadly, especially if it metastasizes (spreading elsewhere in the body). In the United States, cancer is the leading cause of death for people under 65 years old. We plan to study thyroid cancer specifically, which is projected to have 44,000 new cases this year, and is unique in that (although statistically insignificant) its death rate has trended upwards in recent years (whereas many have had a statistically significant decrease).1 Thyroid cancer occurs in the thyroid, an endocrine system gland located at the base of the neck that regulates heart rate, blood pressure, body temperature and weight hormonally.
  
  Luckily, thyroid cancer has treatment options, including surgical removal and Radioactive Iodine therapy (RAI) that targets cancerous thyroid cells by exposing them to radioactive iodine (which is primarily taken up by the thyroid). However, treatment response can vary, and monitoring how well a patient responds is critical. We believe that a poor response may increase the likelihood of recurrence. As such, understanding factors such as treatment response on recurrence is highly valuable for deciding a patientâ€™s next steps.
  
  This study investigates the following research question: Holding other relevant factors constant (age, gender, prior radiotherapy, and clinical risk classification), how does initial treatment response predict thyroid cancer recurrence? We hypothesize that the response to the treatment is a statistically significant predictor of thyroid cancer recurrence, holding other variables we suspect to be significant constant.
  
Our findings indicate that treatment response is a statistically significant predictor of recurrence when controlling for age, gender, radiotherapy history, and risk classification. We also explore the relationships among these explanatory variables for further statistical analysis.
  
  
## **Methods**
The dataset for this study was sourced from Kaggle and originates from a published article by Hamadan University in the European Archives of Oto-Rhino-Laryngology. It contains data on 383 thyroid cancer patients, each of whom was followed for at least 10 years, with records spanning over a 15-year period. The dataset includes information related to patient demographics, treatment history, and clinical outcomes.

To answer our research question, we examined the following variables: 

- Recurrence (Binary Categorical Dependent Variable): Whether or not cancer recurred.
- Age (Quantitative Explanatory Variable): Patient's age in years.
- Gender (Binary Categorical Explanatory Variable): Male or female.
- Radiotherapy (Binary Categorical Explanatory Variable): History of prior radiotherapy (yes or no).
- Risk (3 Level Categorical Explanatory Variable): Cancer risk classification (low, medium, high).
- Response (4 Level Categorical Explanatory Variable): Initial treatment response (excellent, indeterminate, structural incomplete, biochemical incomplete).

For further analysis, we recoded the Recurrence variable as a binary indicator (0 = no recurrence, 1 = recurrence) and collapsed Risk into a binary variable (high vs. not high). We then fit a multiple logistic regression model using recurrence as the response variable and the following as predictors: treatment response, age, gender, radiotherapy history, and binary risk classification. 

Since our primary predictors are categorical, the assumption of linearity in the logit is satisfied by the nature of categorical predictors. Additionally, the assumptions of independence and randomness were reasonably met based on the data collection methodology. (WE WILL DISCUSS THIS MORE IN FINAL DRAFT)

```{r echo = F, include = F}
data <- data %>%
  mutate(Recurred = ifelse(Recurred == "Yes", 1,
                           ifelse(Recurred == "No", 0, NA)))

data <- data %>%
  mutate(risk_binary = case_when(
    Risk == "High" ~ "High",
    TRUE ~ "Not High"
  ))
```

```{r echo = F, include = F, Warning = F}
logistic_model <- glm(Recurred ~ Response + Age + Gender + Hx.Radiothreapy + risk_binary, data, family = "binomial")
#summary(logistic_model)
```


## **Analysis and Results**

The summary table from the model as described above is:
```{r echo = F, Warning = F}
kable(summary(logistic_model)$coefficients, digits = 3, caption = "Logistic Regression for Thyroid Cancer Recurrence")
```

The fitted model is structured as follows: 

\begin{align*}
\log\left(\frac{\pi}{1 - \pi}\right) =\ & 24.05538 \\
& - 4.69692\,\text{(ResponseExcellent)} \\
& - 1.66295\,\text{(ResponseIndeterminate)} \\
& + 4.00775\,\text{(ResponseStructuralIncomplete)} \\
& + 0.03017\,\text{(Age)} \\
& + 1.04256\,\text{(GenderM)} \\
& - 10.63361\,\text{(Hx.RadiotherapyYes)} \\
& - 26.05770\,\text{(risk\_binaryNotHigh)}
\end{align*}

From this, we can see that the response to treatment is a statistically significant predictor of thyroid cancer recurrence.

With a coefficient of -4.69692, this indicates that for patients in the Excellent response group, the predicted odds of thyroid recurrence are about 99.1% lower with all other variables held constant. With a coefficient of -1.66295, this indicates that for patients whose response was indeterminate, that group had predicted odds of thyroid recurrence are about 81.1% lower compared to the reference while all other variables are held constant. Finally, the group that had a Structural Incomplete response had a coefficient of 4.00775, meaning that the predicted odds of thyroid recurrence are about 5408% compared to the reference while all other variables are held constant. This difference in results and predicted thyroid recurrence shows that the response to treatment is not only statistically significant, but may have large outcomes on patient health. #! (WE WILL BE SWAPPING THE REFERENCE FROM BIOCHEMICAL INCOMPLETE TO INDETERMINATE)

```{r echo = F, fig.width = 10, fig.height= 6}
ggplot(data, aes(x = Response, y = Recurred/sum(Recurred))) +
  geom_col() +
  labs(x = "Response to Treatment", y = "Proportion of Recurrence", title = "Proportion of Recurrence by Treatment Resposne")
```

This graph shows the proportion of recurrence by treatment response.

However, we also want to look at some of the other variables that were close to statistical significance (particularly age and gender) and how they may relate to how the patient responds to treatment, as well as their effects on recurrence.

Age & Gender Effects on Recurrence:
```{r , Message = F, Warning = F, fig.width = 5, fig.height= 3, echo = F}

p1 <- ggplot(data, aes(x = Age, y = Recurred)) + 
  geom_jitter(height = 0.02, alpha = 0.6) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"))

p2 <- ggplot(data, aes(x = Gender, fill = factor(Recurred))) +
  geom_bar(position = "fill") +
  labs(y = "Proportion", fill = "Recurrence")

suppressMessages(suppressWarnings(grid.arrange(p1, p2, nrow = 1)))
```


Age & Gender effects on Response:
```{r , Message = F, Warning = F, fig.width = 10, fig.height= 6, echo = F}
ggplot(data, aes(x = Age, y = Response)) + 
  geom_boxplot()

ggplot(data, aes(x = factor(Gender), fill = Response)) +
  geom_bar(position = "fill")

model <- aov(Age ~ Response, data)
summary(model)
TukeyHSD(model)
```
From a an ANOVA and Tukey's, we see that Age is highly relevant to treatment response, particularly in separating Excellent from the other categories. Additionally, females were much more likely to have a better response to treatment than males.

As such, some multicollinearity between Age/Gender and Recurrence are present, perhaps due to Age/Gender having an effect on Response treatment.

## **Discussion**

\newpage
## **References**
