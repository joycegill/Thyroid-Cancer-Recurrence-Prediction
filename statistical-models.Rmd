---
title: 'Predicting Thyroid Cancer Recurrence'
author: "Joyce Gill, Matthew Billings-Chiu"
date: "2025-05-02"
output:
  pdf_document:
    toc: true
    toc_dept: 2
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo = F, include = F}
library(dplyr)
library(ggplot2)
library(tidyr)
library(forcats)
library(kableExtra)
library(gridExtra)
```

```{r echo = F, include = F}
## Open Data
data <- read.csv("https://raw.githubusercontent.com/joycegill/Thyroid-Cancer-Recurrence-Prediction/main/filtered_thyroid_data.csv")
```

\newpage
## **Introduction**
  Cancer is the unregulated proliferation of cells which consume dangerous and disproportionately high amounts of energy from the body. These cells can shunt blood flow to maintain their high metabolic cost and increasing size (potentially blocking organ function), which becomes deadly, especially if it metastasizes (spreading elsewhere in the body) (Mayo Clinic 2024). In the United States, cancer is the leading cause of death for people under 65 years old (Cancer.gov 2025). We plan to study thyroid cancer specifically, which is projected to have 44,000 new cases this year, and is unique in that (although statistically insignificant) its death rate has trended upwards in recent years (whereas many have had a statistically significant decrease) (Cancer.gov 2025). Thyroid cancer occurs in the thyroid, an endocrine system gland located at the base of the neck that regulates heart rate, blood pressure, body temperature and weight hormonally (Borzooei et al. 2023).
  
  Luckily, thyroid cancer has treatment options, including surgical removal and Radioactive Iodine therapy (RAI) that targets cancerous thyroid cells by exposing them to radioactive iodine (which is primarily taken up by the thyroid) (Mayo Clinic 2024). However, treatment response can vary, and monitoring how well a patient responds is critical. We believe that a poor response may increase the likelihood of recurrence. As such, understanding factors such as treatment outcome on recurrence is highly valuable for deciding a patient’s next steps.
  
  This study investigates the following research question: Holding other relevant factors constant (age, gender, prior radiotherapy, and clinical risk classification), is initial treatment response a statistically significant predictor of thyroid cancer recurrence? We hypothesize that the response to the treatment is a statistically significant predictor of thyroid cancer recurrence, holding other variables we suspect to be significant constant.
  
Our findings indicate that treatment outcome is a statistically significant predictor of recurrence when controlling for age, gender, radiotherapy history, and risk classification. We also explore the relationships among these explanatory variables for further statistical analysis.
  
  
## **Methods**
The dataset for this study was sourced from Kaggle and originates from a published article by Hamadan University in the European Archives of Oto-Rhino-Laryngology. It contains data on 383 thyroid cancer patients, each of whom was followed for at least 10 years, with records spanning over a 15-year period. The dataset includes information related to patient demographics, treatment history, and clinical outcomes.

To answer our research question, we examined the following variables: 

- Recurrence (Binary Categorical Dependent Variable): Whether or not cancer recurred.
- Age (Quantitative Explanatory Variable): Patient's age in years.
- Gender (Binary Categorical Explanatory Variable): Male or female.
- Radiotherapy (Binary Categorical Explanatory Variable): History of prior radiotherapy (yes or no).
- Risk (3 Level Categorical Explanatory Variable): Cancer risk classification (low, medium, high).
- TreatmentOutcome (4 Level Categorical Explanatory Variable): Initial treatment response (excellent, indeterminate, structural incomplete, biochemical incomplete).

For further analysis, we recoded the Recurrence variable as a binary indicator (0 = no recurrence, 1 = recurrence) and collapsed Risk into a binary variable (high vs. not high). We then fit a multiple logistic regression model using recurrence as the response variable and the following as predictors: treatment outcome, age, gender, radiotherapy history, and binary risk classification.

Recurrence = B0 + B1 (TreatmentOutcome) + B2(Age) + B3(Gender) + B4(Radiotherapy) + B5(risk_binary)

Since our primary predictors are categorical, the assumption of linearity in the logit is satisfied by the nature of categorical predictors. Additionally, the assumptions of independence and randomness were reasonably met based on the data collection methodology. (#! WE WILL DISCUSS THIS MORE IN FINAL DRAFT, AND IMPLICATIONS FOR INFERENTIAL / WHAT P-VALUES MEAN)

```{r echo = F, include = F}
data <- data %>%
  mutate(Recurred = ifelse(Recurred == "Yes", 1,
                           ifelse(Recurred == "No", 0, NA)))

data <- data %>%
  rename(TreatmentOutcome = Response)

data <- data %>%
  rename(Radiotherapy = Hx.Radiothreapy)

data <- data %>%
  mutate(risk_binary = case_when(
    Risk == "High" ~ "High",
    TRUE ~ "Not High"
  ))

#data$TreatmentOutcome <- relevel(as.factor(data$TreatmentOutcome), ref = "Indeterminate")  
data$TreatmentOutcome <- factor(data$TreatmentOutcome, 
                                 levels = c("Indeterminate", "Excellent", "Biochemical Incomplete", "Structural Incomplete"))  
```

```{r echo = F, include = F, Warning = F}
logistic_model <- glm(Recurred ~ TreatmentOutcome + Age + Gender + Radiotherapy + risk_binary, data, family = "binomial")
#summary(logistic_model)
```


## **Analysis and Results**

The summary table from the model as described above is:
```{r echo = F, Warning = F}
kable(summary(logistic_model)$coefficients, digits = 3, caption = "Logistic Regression for Thyroid Cancer Recurrence")
#summary(logistic_model)
```

The fitted model is structured as follows: 

\begin{align*}
\log\left(\frac{\pi}{1 - \pi}\right) =\ & 24.05538 \\
& - 3.034\,\text{(TreatmentOutcomeExcellent)} \\
& + 1.663\,\text{(TreatmentOutcomeIndeterminate)} \\
& + 5.671\,\text{(TreatmentOutcomeStructuralIncomplete)} \\
& + 0.030\,\text{(Age)} \\
& + 1.043\,\text{(GenderM)} \\
& - 10.634\,\text{(RadiotherapyYes)} \\
& - 26.058\,\text{(risk\_binaryNotHigh)}
\end{align*}

#! DISCUSS AIC FOR MODEL FIT?

From this, we can see that the treatment outcome is a statistically significant predictor of thyroid cancer recurrence.

Using the Indeterminate treatment response as a reference, we found that the Excellent outcome group had a coefficient of -3.034, this indicates that for patients in the Excellent outcome group, the predicted odds of thyroid recurrence are about 95.2% lower with all other variables held constant. With a coefficient of 1.663, this indicates that for patients whose outcome was biochemical incomplete, that group had predicted odds of thyroid recurrence are about 427.5% higher compared to the reference while all other variables are held constant. Finally, the group that had a Structural Incomplete outcome had a coefficient of 5.671, meaning that the predicted odds of thyroid recurrence are about 28932.5% higher compared to the reference while all other variables are held constant. This difference in results and predicted thyroid recurrence shows that the outcome to treatment is not only statistically significant, but may have large outcomes on patient health. These trends can be visualized in the plot shown below.

```{r echo = F, fig.width = 6.5, fig.height= 3.75}
ggplot(data, aes(x = TreatmentOutcome, y = Recurred/sum(Recurred))) +
  geom_col() +
  labs(x = "Outcome of Treatment", y = "Proportion of Recurrence", title = "Proportion of Recurrence by Treatment Response")
```

This graph shows the proportion of recurrence by treatment outcome.

Looking at some of the other variables, interestingly, with p-values of 0.99649 and 0.99381 for both the use of Radiotherapy treatment and binary risk level respectively, we can see that these variables are not statistically significant predictors of thyroid cancer recurrence. (#! SHOULD THIS ALSO INCLUDE COEFFICIENT ANALYSIS?)
However, both Age and Gender might be worth looking at, because although they do not reach the the significance level of .05, they are close to the significance level of .1 with p-values of 0.12548 and 0.10651 respectively, with their trends in relation to recurrence shown below. Additionally, in the context of the data, they may be worth investigating further. This is especially important due to the relatively large effect size of these variables. For every year increase in age (holding all other variables constant), the predicted odds of recurrence would increase by about 1.03. 

Age & Gender Effects on Recurrence:

```{r , Message = F, Warning = F, fig.width = 8, fig.height= 3.5, echo = F}
p1 <- ggplot(data, aes(x = Age, y = Recurred)) + 
  geom_jitter(height = 0.02, alpha = 0.4) +
  geom_smooth(method = "glm", method.args = list(family = "binomial"))

p2 <- ggplot(data, aes(x = Gender, fill = factor(Recurred))) +
  geom_bar(position = "fill") +
  labs(y = "Proportion", fill = "Recurrence")

suppressMessages(suppressWarnings(grid.arrange(p1, p2, nrow = 1)))
```

From these exploratory plots, there appears to be a relationship between these explanatory variables and recurrence, however once again, they do not reach standard significance levels. Despite this, univariate models show they are individually associated with recurrence, which may hint at multicollinearity or a relation with treatment outcome to result in a deflated effectiveness together (Appendix). As a result, we wanted to see if Age and Gender may have effects on how the patient may respond to treatment, as well as their effects on recurrence.

Exploratory Graphs of Age & Gender effects on Outcome:

```{r , Message = F, Warning = F, fig.width = 10, fig.height= 3.5, echo = F}
p3 <- ggplot(data, aes(x = Age, y = TreatmentOutcome)) + 
  geom_boxplot() +
  labs(x = "Age (years)", y = "Treatment Outcome", title = "Treatment Outcome by Age")

p4 <- ggplot(data, aes(x = factor(Gender), fill = as.factor(TreatmentOutcome))) +
  geom_bar(position = "fill") +
  labs(x = "Gender", y = "Proportion", fill = "Treatment Outcome", title = "Treatment Outcome by Gender")

suppressMessages(suppressWarnings(grid.arrange(p3, p4, nrow = 1)))
```

In the boxplot comparing Age by Treatment Outcome, we can see that all groups except for Excellent have a similar median and spread, however the Excellent treatment outcome group has a lower median age than that of the other groups. This correlation continues into a one-way ANOVA comparing Age and Treatment Outcome and a Tukey's test. The conditions for this model are discussed in the appendix #!.

```{r}
model <- aov(Age ~ TreatmentOutcome, data)
summary(model)
#kable(summary(model)$model, digits = 3, caption = "ANOVA for Correlation between Treatment Outcome and Age")
tukey <- TukeyHSD(model)

```

From a an ANOVA and Tukey's, we see that Age is highly relevant to treatment outcome, particularly in separating Excellent from the other categories. Additionally, females were much more likely to have a better outcome for treatment than males.

In the stacked barchart, it appears that Females are proportionally much more likely to get an Excellent treatment outcome than Males, while the proportion of Indeterminate and Biochemical incomplete outcomes remain relatively consistent. Conversely, Males are proportionally much more likely to get a Structural Incomplete treatment outcome than Females. This trend is shown/not shown in the analysis (conditions are discussed in Appendix - or maybe they won't be if it's just a correlation test, which won't need explanation #!).

#! STATISTICAL ANALYSIS HERE
```{r}
#the corr matrix for this needs fixing
#num_gender <- as.numeric(data$Gender)


#data <- data %>%
#  mutate(num_gender = as.numeric(Gender))

# cor_matrix <- cor(data[, c("num_gender", "TreatmentOutcome")])
# kable(cor_matrix, digits = 2, caption = "Correlation Matrix of Gender and TreatmentOutcome")
# pairs(data[, c("Gender", "TreatmentOutcome")])
```

As such, some multicollinearity between Age/Gender and Recurrence are present, perhaps due to Age/Gender having an effect on treatment outcome.

## **Discussion**

Referring to the question motivating the study, is initial treatment response a statistically significant predictor of thyroid cancer recurrence? Our study found that in the model containing the previously discussed variables, yes, treatment response is a statistically significant predictor of thyroid cancer recurrence. Although the model did not find variables like Age and Gender to be effective predictors of Recurrence, their effectiveness may have been deflated due to multicollinearity issues with the very significant predictor of Treatment Response. This may be especially important, because although our study does not prove causation between Age or Gender on Treatment Outcome, there is a correlation that may be interesting to pursue for further research.
These results are generalizable to ______ (need to discuss randomness/independence more in the Methods. #!


\newpage
## **Appendix**

References:

Borzooei, S., Briganti, G., Golparian, M. et al. Machine learning for risk stratification of thyroid cancer patients: a 15-year cohort study. 
  Eur Arch Otorhinolaryngol 281, 2095–2104 (2024). https://doi.org/10.1007/s00405-023-08299-w.

“Common Cancer Sites - Cancer Stat Facts.” SEER (2025). seer.cancer.gov/statfacts/html/common.html#comparison. 

“Thyroid Cancer.” Mayo Clinic, Mayo Foundation for Medical Education and Research, 5 Jan. 2024, 
  www.mayoclinic.org/diseases-conditions/thyroid-cancer/symptoms-causes/syc-20354161.


Source Used for Data:

"Thyroid Cancer Recurrence Dataset." Kaggle (2025). https://www.kaggle.com/datasets/aneevinay/thyroid-cancer-recurrence-dataset


Data:

```{r}
#Both Age and Gender individually are statistically significant
logistic_Age <- glm(Recurred ~ Age, data, family = "binomial")
summary(logistic_Age)

logistic_Gender <- glm(Recurred ~ Gender, data, family = "binomial")
summary(logistic_Gender)
```
```{r}
#Discuss the ANOVA model conditions #!
plot(model)
```









